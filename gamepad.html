<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Stack Gamepad</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #111;
    }

    #touchButton {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 8vw;
      background: #222;
    }
  </style>
</head>

<body>
  <div id="touchButton">TAP TO STACK</div>

  <!-- 1) Photon Realtime UMD must load FIRST -->
  <script src="https://unpkg.com/photon-realtime@5.1.5/build/photon-realtime.umd.min.js"></script>
  <script>
    (function () {
      if (!window.PhotonRealtime || !PhotonRealtime.LoadBalancingClient) {
        console.error("PhotonRealtime failed to load");
        alert("Error: PhotonRealtime not loaded.");
        return;
      }

      const params = new URLSearchParams(location.search);
      const appId = params.get("appId");
      const room = params.get("room");
      const player = parseInt(params.get("player"), 10);

      if (!appId || !room || isNaN(player)) {
        document.getElementById("touchButton").innerText = "Invalid URL params";
        return;
      }

      const client = new PhotonRealtime.LoadBalancingClient(
        PhotonRealtime.ConnectionProtocol.Udp
      );
      client.setLogLevel(PhotonRealtime.DebugLevel.WARNING);
      client.addCallbackTarget({
        onConnected: () => console.log("JS: connected"),
        onConnectedToMaster: () => { console.log("JS: joining", room); client.joinRoom(room); },
        onJoinedRoom: () => document.getElementById("touchButton").innerText = "PLAYER " + player,
        onJoinRoomFailed: (c, m) => console.error("Join failed", c, m),
        onError: (code, msg) => console.error("Photon Error", code, msg)
      });
      client.connectUsingSettings({
        AppIdRealtime: appId,
        AppVersion: "1.0",
        FixedRegion: "eu"
      });
      const btn = document.getElementById("touchButton");
      btn.addEventListener("touchstart", tap); btn.addEventListener("mousedown", tap);
      function tap(e) {
        e.preventDefault();
        if (client.getState() !== PhotonRealtime.ClientState.Joined) return;
        client.raiseEvent(1, player,
          new PhotonRealtime.RaiseEventOptions({ Receivers: PhotonRealtime.ReceiverGroup.All }),
          new PhotonRealtime.SendOptions({ Reliability: true })
        );
      }
    })();
  </script>
</body>

</html>